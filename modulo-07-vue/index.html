<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel Full-Stack</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-10 font-sans">

    <div id="app" class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8">
        
        <div class="bg-white p-6 rounded-lg shadow-lg col-span-1 h-fit border-t-4 border-green-500">
            <h2 class="text-xl font-bold mb-4 text-gray-800">Novo M√©dico ‚ûï</h2>
            
            <input v-model="novoNome" type="text" placeholder="Nome Completo" class="w-full mb-3 p-2 border rounded focus:outline-none focus:ring-2 focus:ring-green-400">
            <input v-model="novaEspec" type="text" placeholder="Especialidade" class="w-full mb-4 p-2 border rounded focus:outline-none focus:ring-2 focus:ring-green-400">
            
            <button @click="cadastrarMedico" class="w-full bg-green-500 text-white font-bold py-2 rounded hover:bg-green-600 transition">
                Salvar no Banco
            </button>
        </div>

        <div class="col-span-2">
            <h1 class="text-3xl font-bold mb-6 text-blue-600">Equipe M√©dica üè•</h1>
            
            <div v-if="carregando" class="text-gray-500 animate-pulse">Buscando dados no servidor local... üì°</div>
            
            <div v-else class="space-y-4">
                <div v-for="medico in medicos" :key="medico.id" class="bg-white p-5 rounded-lg shadow flex justify-between items-center border-l-4 border-blue-500">
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">{{ medico.nome }}</h3>
                        <p class="text-gray-600">ü©∫ {{ medico.especialidade }}</p>
                        <span class="inline-block mt-2 px-2 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded-full">
                            {{ medico.status }}
                        </span>
                    </div>
                    
                    <button @click="demitirMedico(medico.id)" class="text-red-500 hover:text-red-700 bg-red-50 p-2 rounded-full transition">
                        üóëÔ∏è apagar
                    </button>
                </div>

                <div v-if="medicos.length === 0" class="text-center text-gray-500 py-10 bg-white rounded-lg shadow">
                    Nenhum m√©dico cadastrado. Use o formul√°rio ao lado!
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;

        createApp({
            setup() {
                const medicos = ref([]);
                const carregando = ref(true);
                
                // Vari√°veis do Formul√°rio
                const novoNome = ref('');
                const novaEspec = ref('');

                // 1. Fun√ß√£o READ (M√©todo GET) - Busca a lista
                async function buscarMedicos() {
                    try {
                        // Aten√ß√£o: Agora estamos chamando o NOSSO servidor!
                        const resposta = await fetch('https://api-medicos-gregory.onrender.com/medicos');
                        medicos.value = await resposta.json();
                    } catch (erro) {
                        alert("Erro de conex√£o! O servidor Node.js est√° rodando?");
                    } finally {
                        carregando.value = false;
                    }
                }

                // 2. Fun√ß√£o CREATE (M√©todo POST) - Envia um novo
                async function cadastrarMedico() {
                    if(!novoNome.value || !novaEspec.value) return alert("Preencha todos os campos!");

                    await fetch('https://api-medicos-gregory.onrender.com/medicos', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            nome: novoNome.value,
                            especialidade: novaEspec.value
                        })
                    });

                    // Limpa o formul√°rio
                    novoNome.value = '';
                    novaEspec.value = '';
                    
                    // Busca a lista atualizada do banco para mostrar na tela
                    buscarMedicos();
                }

                // 3. Fun√ß√£o DELETE (M√©todo DELETE) - Apaga pelo ID
                async function demitirMedico(id) {
                    if(confirm("Tem certeza que deseja apagar este m√©dico?")) {
                        await fetch(`https://api-medicos-gregory.onrender.com/medicos/${id}`, {
                            method: 'DELETE'
                        });
                        // Atualiza a lista na tela
                        buscarMedicos();
                    }
                }

                // Assim que a tela carrega, busca os dados
                onMounted(() => {
                    buscarMedicos();
                });

                return {
                    medicos, carregando, novoNome, novaEspec,
                    cadastrarMedico, demitirMedico
                }
            }
        }).mount('#app');
    </script>
</body>
</html>